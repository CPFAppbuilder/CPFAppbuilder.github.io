<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <title>PM2.5</title>
</head>
<body>
    <div class="container">
        <div class="col-xs-12">
            <h3 id="voicet_text">請輸入[縣市名稱]以及[地區]（ex. 新北市汐止的空氣如何？）</h3>
        </div>
        <div class="col-xs-12">
            <button class="btn-info" id="clickbtn" style="padding: 10px 30px">VOICE</button>
        </div>
    </div>
    
    
</body>

<script>
    // setup();
    var pm_data;
    var qq = "Hello";
    var clickbtn = $('#clickbtn');
    var voicet_text = $('#voicet_text');

    window.onload = function(){
        //get pm2.5 data
        var data_url="https://opendata2.epa.gov.tw/AQX.json";

        $.ajax({
            url: data_url,
            success: function(res){
                pm_data = res;

                // for(var i=1;i<=pm_data.length;i++){
                //     var item = pm_data[i];

                    
                //     var now_class = (item.done==true)?"done":"";
                //     var now_item = item_templete.replace("{{name}}", item.name)
                //                                 .replace("{{num}}", i)
                //                                 .replace("{{date}}", item.date)
                //                                 .replace("{{class}}", now_class);
                //     $("#listitem").append(now_item);
                // }
            }
        });

        clickbtn.on('click', function(){
            console.log("Button pressed!");
            cpf.initSpeechRecognition("cmn-Hant-TW");
        });
    }

    function GetRecognizeResult(Result,Type){
        for(var i=1;i<=pm_data.length;i++){
            var item = pm_data[i];
            if(Result.includes("空氣") && Result.includes(item.County) && Result.includes(item.SiteName)){
                console.log(item['County']+item['SiteName']+"的 P M 二點五數值為"+item['PM2.5']);
                cpf.SetSpeech("Off", "cmn-Hant-TW", item['County']+item['SiteName']+"的PM2.5數值為"+item['PM2.5'], 1, 0.5);
                voicet_text.html(item['County']+item['SiteName']+"的 PM2.5數值為"+item['PM2.5']);

            }
            else{
                console.log('辨識失敗，請重新輸入一次！');
                voicet_text.html('辨識失敗，請重新輸入一次！');
            }

        }
        
        console.log('Result = ' + Result);
        if(Result.includes("空氣")) {
            cpf.request('["grove_setColorRGB", 0, 0, 0, 255]');
            cpf.SetSpeech("Off", "cmn-Hant-TW", "藍色", 1, 0.5);
        }
        else{
            cpf.request('["grove_setColorRGB", 0, 255, 0, 0]');
            cpf.SetSpeech("Off", "cmn-Hant-TW", "紅色", 1, 0.5);
        }
    }
    


    //cpf設定
    function setup(){
        if(cpf){
            cpf.setPinMode('["resetPin"],["grove_newChainableLED", 7, 8, 1]'); 
        }
    }
    //LED燈顏色設定
	function changeColor(color){
		if(cpf){ 
			cpf.request('["grove_setColorRGB", 0, ' + color + ']');
		}
	}
	
</script>
</html>